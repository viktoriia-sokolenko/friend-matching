{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext,useMemo}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[token,setToken]=useState(\"\");const[userId,setUserId]=useState(localStorage.getItem(\"user_id\")||null);const[toggleTrigger,setToggleTrigger]=useState(0);const listOfInterests=[\"History/Politics\",\"Science/Technology\",\"Video Games\",\"Sports/Fitness\",\"Sports (watching)\",\"Literature\",\"Film/Television\",\"Music\",\"Visual Arts\",\"Performing Arts\",\"Cooking/Baking\",\"Crafts/DIY\",\"Hiking/Outdoor activities\",\"Travel\",\"Sustainability\",\"Activism/Advocacy\",\"Volunteering\",\"Other\"];const getInterestVector=rankedInterests=>{return listOfInterests.map(interest=>rankedInterests[interest]||0);};const calculateSimilarity=(vec1,vec2)=>{const dotpdt=vec1.reduce((acc,val,i)=>acc+val*vec2[i],0);const vec1sqrd=vec1.reduce((acc,val)=>acc+val*val,0);const vec2sqrd=vec2.reduce((acc,val)=>acc+val*val,0);if(vec2sqrd==0||vec1sqrd==0){return 0;}const cosineSimilarity=dotpdt/(Math.sqrt(vec1sqrd)*Math.sqrt(vec2sqrd));return Math.max(0,cosineSimilarity)*100;};const getInterestScore=(rankings,user)=>{const userVector=getInterestVector(user.user_profiles.rankings);const studentVector=getInterestVector(rankings);const score=calculateSimilarity(userVector,studentVector);return score.toFixed(2);};const memoizedGetInterestScore=useMemo(()=>getInterestScore,[getInterestVector,calculateSimilarity]);const handleLogout=()=>{if(userId){setUserId(\"\");localStorage.removeItem(\"user_id\");setToken(\"\");localStorage.removeItem(\"access_token\");setSavedProfiles([]);window.location=\"/\";}};const[savedProfiles,setSavedProfiles]=useState([]);useEffect(()=>{const fetchSavedProfiles=async()=>{if(!userId||!token)return;try{const response=await fetch(\"/users/saved_profiles/\".concat(userId),{method:'GET',headers:{Authorization:\"Bearer \".concat(token)}});if(!response.ok){throw new Error(\"Error fetching saved profiles: \".concat(response.status));}const data=await response.json();setSavedProfiles(data);}catch(error){console.error('Error fetching saved profiles:',error);}};fetchSavedProfiles();},[userId,token,toggleTrigger]);const handleToggleSave=async(profileId,isSaved)=>{const method=isSaved?'DELETE':'POST';const endpoint=\"/users/saved_profiles/\";const body=JSON.stringify({saved_id:profileId,user_id:userId});try{const response=await fetch(endpoint,{method,headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'},body});if(response.ok){setToggleTrigger(prev=>prev+1);// Trigger fetch\n}else{throw new Error(\"Failed to toggle profile save: \".concat(response.status));}}catch(error){console.error('Error toggling saved profile:',error);}};useEffect(()=>{const hashParams=new URLSearchParams(window.location.hash.substring(1));const accessToken=hashParams.get(\"access_token\");if(accessToken){setToken(accessToken);localStorage.setItem(\"access_token\",accessToken);window.history.replaceState(null,\"\",window.location.pathname);}else{const savedToken=localStorage.getItem(\"access_token\");if(savedToken){setToken(savedToken);}}},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token,setToken,userId,setUserId,handleLogout,savedProfiles,handleToggleSave,listOfInterests,memoizedGetInterestScore},children:children});};export const useAuth=()=>{return useContext(AuthContext);};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useMemo","jsx","_jsx","AuthContext","AuthProvider","_ref","children","token","setToken","userId","setUserId","localStorage","getItem","toggleTrigger","setToggleTrigger","listOfInterests","getInterestVector","rankedInterests","map","interest","calculateSimilarity","vec1","vec2","dotpdt","reduce","acc","val","i","vec1sqrd","vec2sqrd","cosineSimilarity","Math","sqrt","max","getInterestScore","rankings","user","userVector","user_profiles","studentVector","score","toFixed","memoizedGetInterestScore","handleLogout","removeItem","setSavedProfiles","window","location","savedProfiles","fetchSavedProfiles","response","fetch","concat","method","headers","Authorization","ok","Error","status","data","json","error","console","handleToggleSave","profileId","isSaved","endpoint","body","JSON","stringify","saved_id","user_id","prev","hashParams","URLSearchParams","hash","substring","accessToken","get","setItem","history","replaceState","pathname","savedToken","Provider","value","useAuth"],"sources":["/Users/viktoriiasokolenko/Documents/disc/my-app/client/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext, useMemo } from 'react';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n    const [token, setToken] = useState(\"\");\n    const [userId, setUserId] = useState(localStorage.getItem(\"user_id\") || null);\n    const [toggleTrigger, setToggleTrigger] = useState(0);\n    const listOfInterests = [\"History/Politics\", \"Science/Technology\", \"Video Games\", \"Sports/Fitness\", \"Sports (watching)\", \"Literature\", \"Film/Television\", \"Music\", \"Visual Arts\", \"Performing Arts\", \"Cooking/Baking\", \"Crafts/DIY\", \"Hiking/Outdoor activities\", \"Travel\", \"Sustainability\", \"Activism/Advocacy\", \"Volunteering\", \"Other\"];\n    const getInterestVector = (rankedInterests) =>{\n        return listOfInterests.map(interest => rankedInterests[interest] || 0);\n    }\n    const calculateSimilarity = (vec1, vec2) => {\n        const dotpdt = vec1.reduce((acc, val, i) => acc + val * vec2[i], 0);\n        const vec1sqrd = vec1.reduce((acc, val) => acc + val * val, 0);\n        const vec2sqrd = vec2.reduce((acc, val) => acc + val * val, 0);\n        if (vec2sqrd == 0 || vec1sqrd == 0){\n            return 0;\n        }\n        const cosineSimilarity = (dotpdt/(Math.sqrt(vec1sqrd)*Math.sqrt(vec2sqrd)));\n        return (Math.max(0, cosineSimilarity)*100);\n    }\n    const getInterestScore = (rankings, user) => {\n        const userVector = getInterestVector(user.user_profiles.rankings);\n        const studentVector = getInterestVector(rankings);\n        const score = calculateSimilarity(userVector, studentVector);\n        return score.toFixed(2);\n    }\n    const memoizedGetInterestScore = useMemo(() => getInterestScore, [getInterestVector, calculateSimilarity]); \n    const handleLogout = () => {\n        if (userId) {\n            setUserId(\"\");\n            localStorage.removeItem(\"user_id\");\n            setToken(\"\");\n            localStorage.removeItem(\"access_token\");\n            setSavedProfiles([]);\n            window.location = `/`;\n        }\n    };\n    const [savedProfiles, setSavedProfiles] = useState([]);\n    useEffect(() => {\n        const fetchSavedProfiles = async () => {\n            if (!userId || !token) return;\n            try {\n              const response = await fetch(`/users/saved_profiles/${userId}`, {\n                method: 'GET',\n                headers: {\n                  Authorization: `Bearer ${token}`,\n                },\n              });\n              if (!response.ok) {\n                throw new Error(`Error fetching saved profiles: ${response.status}`);\n              }\n              const data = await response.json();\n              setSavedProfiles(data);\n            } catch (error) {\n              console.error('Error fetching saved profiles:', error);\n            }\n          };\n        fetchSavedProfiles();\n    }, [userId, token, toggleTrigger]);\n    const handleToggleSave = async (profileId, isSaved) => {\n        const method = isSaved ? 'DELETE' : 'POST';\n        const endpoint = `/users/saved_profiles/`;\n        const body = JSON.stringify({ saved_id: profileId, user_id: userId });\n\n        try {\n            const response = await fetch(endpoint, {\n                method,\n                headers: {\n                    Authorization: `Bearer ${token}`,\n                    'Content-Type': 'application/json',\n                },\n                body,\n            });\n            if (response.ok) {\n                setToggleTrigger((prev) => prev + 1);  // Trigger fetch\n            } else {\n                throw new Error(`Failed to toggle profile save: ${response.status}`);\n            }\n        } catch (error) {\n            console.error('Error toggling saved profile:', error);\n        }\n    };\n    useEffect(() => {\n        const hashParams = new URLSearchParams(window.location.hash.substring(1));\n        const accessToken = hashParams.get(\"access_token\");\n        if (accessToken) {\n            setToken(accessToken);\n            localStorage.setItem(\"access_token\", accessToken);\n            window.history.replaceState(null, \"\", window.location.pathname);\n        } else {\n            const savedToken = localStorage.getItem(\"access_token\");\n            if (savedToken) {\n                setToken(savedToken);\n            }\n        }\n    }, []);\n\n    return (\n        <AuthContext.Provider value={{ token, setToken, userId, setUserId, handleLogout, savedProfiles, handleToggleSave, listOfInterests, memoizedGetInterestScore }}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => {\n    return useContext(AuthContext);\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}